<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fpcy.common.dao">
	<!-- 查询所有税局信息 -->
	<select id="TaxOfficeDao_queryAllTaxOffice" parameterType="map"
		resultType="map">
		select * from dm_fpcycs
	</select>

	<!-- 查询税局单条信息 -->
	<select id="TaxOfficeDao_queryOneTaxOffice" parameterType="map"
		resultType="map">
		select * from dm_fpcycs where swjg_dm=#{swjg_dm} and fp_zl=#{fp_zl}
	</select>

	<!-- 查询税局信息 -->
	<select id="TaxOfficeDao_queryTaxOffice" parameterType="map"
		resultType="map">
		select * from dm_fpcycs where swjg_dm=#{swjg_dm}
	</select>
	<!-- 查询发票服务对接接口是否是总局接口 -->
	<select id="TaxOfficeDao_isGenAdmin" parameterType="map"
		resultType="map">
		SELECT DISTINCT isGenAdmin FROM `dm_fpcycs`
		WHERE swjg_dm LIKE #{swjg_dm}
		<if test="swjg_mc_like!=null and swjg_mc_like!=''">
			AND swjg_mc LIKE #{swjg_mc_like};
		</if>
	</select>
	
	<!-- 查询接口信息 -->
    <select id="TaxOfficeDao_selectenablequery" parameterType="map"
		resultType="int">
		SELECT count(*) from fpcy_enablequery where swjg_dm=#{swjg_dm} AND fp_zl=#{fp_zl}
		<if test="poolid!=null and poolid!=''">
			AND poolid=#{poolid}
		</if>
		    AND QUERY=#{query}
	</select>
	
	<!-- 修改解析规则 -->
	<update id="TaxOfficeDao_updateRule"  parameterType="map">
	   update fpcy_taxoffice_role  set role=#{newRole},roleJsName=#{newRoleJsName} 
	   where swjg_mc=#{swjg_mc}
	</update>
	
	<!-- 新增税局规则变化日志表 -->
	<insert id="TaxOfficeDao_insertRuleLog" parameterType="map">
	   INSERT  INTO fpcy_role_log
	   (swjg_mc,newRole,newRoleJsName,oldRole,oldRoleJsName,inputTime)
	   values
	   (#{swjg_mc},#{newRole},#{newRoleJsName},#{oldRole},#{oldRoleJsName},now()) 
	</insert>
	
	<!-- 查询单个发票规则 -->
	<select id="TaxOfficeDao_QueryOneReg" parameterType="map"
		resultType="hashmap">
		SELECT a.role,a.roleJsName FROM fpcy_taxoffice_role a
		WHERE swjg_mc = #{swjg_mc} AND isUse = '0'
	</select>
	
	<!-- 查询所有发票规则 -->
	<select id="TaxOfficeDao_QueryRegAll" parameterType="map"
		resultType="hashmap">
		SELECT a.swjg_mc,a.role,a.roleJsName FROM fpcy_taxoffice_role a
		WHERE isUse = '0'
	</select>
</mapper>